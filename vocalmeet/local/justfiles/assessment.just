# =============================================================================
# Assessment Specific Commands
# =============================================================================

# Quick setup for assessment: start + install required plugins + configure permalinks
assessment-start: start
    @echo "â³ Waiting for WordPress to be ready..."
    @sleep 15
    @echo "ğŸ“¦ Checking plugins..."
    @echo ""
    @echo "   Elementor:"
    @{{compose}} run --rm wpcli plugin is-installed elementor 2>/dev/null && echo "   âœ… Already installed" || ({{compose}} run --rm wpcli plugin install elementor --activate && echo "   âœ… Installed & activated")
    @echo ""
    @echo "   WooCommerce:"
    @{{compose}} run --rm wpcli plugin is-installed woocommerce 2>/dev/null && echo "   âœ… Already installed" || ({{compose}} run --rm wpcli plugin install woocommerce --activate && echo "   âœ… Installed & activated")
    @echo ""
    @echo "ğŸ”§ Configuring permalinks..."
    @{{compose}} run --rm wpcli rewrite structure '/%postname%/' 2>&1 | grep -v "Warning:" || true
    @just fix-htaccess
    @echo ""
    @echo "âœ… Assessment environment ready!"
    @echo "   WordPress:   {{wordpress_url}}"
    @echo "   phpMyAdmin:  {{phpmyadmin_url}}"

# Fix .htaccess for pretty permalinks (WP-CLI can't generate rewrite rules in CLI context)
fix-htaccess:
    @./scripts/fix-htaccess.sh

# Verify assessment setup with health checks
assessment-verify:
    @echo "ğŸ” Verifying assessment setup..."
    @echo ""
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo "ğŸ“¡ Health Checks"
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo ""
    @echo "1ï¸âƒ£  WordPress Site ({{wordpress_url}}):"
    @curl -sk -o /dev/null -w "   HTTP Status: %{http_code}\n   Response Time: %{time_total}s\n" {{wordpress_url}} || echo "   âŒ FAILED - WordPress not responding"
    @echo ""
    @echo "2ï¸âƒ£  WordPress REST API (/wp-json):"
    @curl -sk -o /dev/null -w "   HTTP Status: %{http_code}\n   Response Time: %{time_total}s\n" {{wordpress_url}}/wp-json || echo "   âŒ FAILED - REST API not responding"
    @echo ""
    @echo "3ï¸âƒ£  WooCommerce REST API (/wp-json/wc/v3):"
    @curl -sk -o /dev/null -w "   HTTP Status: %{http_code}\n   Response Time: %{time_total}s\n" {{wordpress_url}}/wp-json/wc/v3 || echo "   âŒ FAILED - WooCommerce API not responding"
    @echo ""
    @echo "4ï¸âƒ£  phpMyAdmin ({{phpmyadmin_url}}):"
    @curl -s -o /dev/null -w "   HTTP Status: %{http_code}\n   Response Time: %{time_total}s\n" {{phpmyadmin_url}} || echo "   âŒ FAILED - phpMyAdmin not responding"
    @echo ""
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo "ğŸ“‹ WordPress Info"
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo ""
    @echo "WordPress version:"
    @{{compose}} run --rm wpcli core version 2>/dev/null || echo "   âŒ Could not get WordPress version"
    @echo ""
    @echo "Active plugins:"
    @{{compose}} run --rm wpcli plugin list --status=active 2>/dev/null || echo "   âŒ Could not list plugins"
    @echo ""
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo "ğŸ”‘ WooCommerce API Keys"
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo ""
    @{{compose}} run --rm wpcli wc api keys list 2>/dev/null || echo "   âš ï¸  No API keys found. Create one:"
    @echo "   â†’ WP Admin: {{wordpress_url}}/wp-admin/admin.php?page=wc-settings&tab=advanced&section=keys"
    @echo "   â†’ Or run:   just wc-create-api-keys"
    @echo ""
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    @echo "âœ… Verification complete!"
    @echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Check if required plugins are installed
assessment-check-plugins:
    @echo "ğŸ“¦ Checking required plugins..."
    @echo ""
    @echo "Elementor:"
    @{{compose}} run --rm wpcli plugin is-installed elementor 2>/dev/null && {{compose}} run --rm wpcli plugin is-active elementor 2>/dev/null && echo "   âœ… Installed & Active" || echo "   âŒ Not installed or inactive"
    @echo ""
    @echo "WooCommerce:"
    @{{compose}} run --rm wpcli plugin is-installed woocommerce 2>/dev/null && {{compose}} run --rm wpcli plugin is-active woocommerce 2>/dev/null && echo "   âœ… Installed & Active" || echo "   âŒ Not installed or inactive"
